<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aether-V â€” Dashboard</title>
    <link rel="stylesheet" href="/static/main.css">
</head>
<body>
    <header class="topbar" role="banner">
        <div class="topbar-left">
            <div class="decorative-square" aria-hidden="true"></div>
            <div class="environment-info">
                <div class="environment-label">Working in</div>
                <div class="environment-name" id="cluster-name">{{ environment_name }}</div>
            </div>
        </div>

        <div class="topbar-center">
            <div class="search-container">
                <span
                    class="icon icon--sm search-icon"
                    aria-hidden="true"
                    style="--icon: url('/static/icons/round/search.svg');"
                ></span>
                <label class="sr-only" for="global-search">Search</label>
                <input id="global-search" class="search" placeholder="Search Everywhere" />
            </div>
        </div>

        <div class="topbar-right">
            <button id="notifications-btn" class="icon-btn" title="Notifications" aria-label="Notifications">
                <span
                    class="icon icon--lg"
                    aria-hidden="true"
                    style="--icon: url('/static/icons/round/notifications.svg');"
                ></span>
            </button>
            <div class="profile-menu">
                <button
                    id="profile-btn"
                    class="icon-btn profile-btn"
                    title="Account"
                    aria-label="Account"
                    aria-haspopup="true"
                    aria-expanded="false"
                    type="button"
                >
                    <span
                        class="icon icon--lg"
                        aria-hidden="true"
                        style="--icon: url('/static/icons/round/account_circle.svg');"
                    ></span>
                </button>
                <div
                    id="profile-overlay"
                    class="profile-overlay"
                    role="dialog"
                    aria-hidden="true"
                    aria-labelledby="profile-name"
                >
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-avatar" aria-hidden="true">
                                <span
                                    class="icon icon--lg"
                                    aria-hidden="true"
                                    style="--icon: url('/static/icons/round/account_circle.svg');"
                                ></span>
                            </div>
                            <div class="profile-text">
                                <div class="profile-name" id="profile-name">Guest user</div>
                                <div class="profile-email" id="profile-email">Not signed in</div>
                            </div>
                        </div>
                        <div class="profile-role-row">
                            <span class="profile-role-label">API role</span>
                            <span class="profile-role-value" id="profile-role">Unavailable</span>
                        </div>
                        <button id="profile-logout-btn" class="profile-logout-btn" type="button">Log out</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="app-shell">
        <nav class="sidebar" aria-label="Primary">
            <ul class="nav-list">
                <li class="nav-item active" data-view="overview">
                    <span
                        class="icon nav-icon"
                        aria-hidden="true"
                        style="--icon: url('/static/icons/round/cloud.svg');"
                    ></span>
                    <span class="nav-label">Overview</span>
                </li>

                <li class="nav-separator"></li>

                <!-- Dynamic clusters will be inserted here -->
                <div id="clusters-container">
                    <!-- Clusters will be populated by JavaScript -->
                </div>

                <!-- Disconnected hosts section -->
                <li class="nav-item disconnected-hosts" data-view="disconnected-hosts" style="display: none;">
                    <span
                        class="icon nav-icon"
                        aria-hidden="true"
                        style="--icon: url('/static/icons/round/warning.svg');"
                    ></span>
                    <span class="nav-label">Disconnected Hosts</span>
                    <span class="badge disconnected-count" style="display: none;">0</span>
                </li>
            </ul>

            <div class="sidebar-footer">
                <div
                    class="sidebar-availability-warning"
                    id="sidebar-availability-warning"
                    role="note"
                    tabindex="0"
                    hidden
                    aria-hidden="true"
                    aria-label="Some virtual machines do not have high availability enabled. Virtual machines with a dashed border around their button do not have high availability enabled and are only placed on that cluster."
                >
                    <span class="warning-text">Some virtual machines do not have high availability enabled.</span>
                    <span
                        class="warning-tooltip"
                        id="sidebar-availability-tooltip"
                        role="tooltip"
                    >Virtual machines with a dashed border around their button do not have high availability enabled and are only placed on that cluster.</span>
                </div>
                <button class="settings-btn" id="sidebar-settings" title="Settings">
                    <span
                        class="icon settings-icon"
                        aria-hidden="true"
                        style="--icon: url('/static/icons/round/settings.svg');"
                    ></span>
                    <span class="settings-label">Settings</span>
                </button>
            </div>
        </nav>

        <main class="content" id="main" role="main">
            <div class="page-inner" id="view-container">
                <!-- Dynamic view content will be rendered here -->
                <div class="loading">Loading...</div>
            </div>
        </main>
    </div>

    <!-- Notifications Overlay -->
    <div id="notifications-overlay" class="notifications-overlay">
        <div class="notifications-card">
            <div class="notifications-header">
                <h3>Notifications</h3>
                <button class="mark-all-read-btn">Mark all as read</button>
            </div>
            <div class="notifications-content">
                <div class="notifications-list">
                    <!-- Notifications will be populated here -->
                    <div class="notification-item">
                        <div class="notification-icon">
                            <span
                                class="icon icon--lg"
                                aria-hidden="true"
                                style="--icon: url('/static/icons/round/assignment.svg');"
                            ></span>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">Job completed</div>
                            <div class="notification-message">VM deployment for "web-server-01" has finished successfully.</div>
                            <div class="notification-time">2 minutes ago</div>
                        </div>
                    </div>
                    <div class="notification-item unread">
                        <div class="notification-icon">
                            <span
                                class="icon icon--lg"
                                aria-hidden="true"
                                style="--icon: url('/static/icons/round/warning.svg');"
                            ></span>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">Host disconnected</div>
                            <div class="notification-message">Host "hyperv-01.domain.local" has lost connection.</div>
                            <div class="notification-time">5 minutes ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Connection Status Indicator -->
    <div id="connection-status-indicator" class="connection-status-indicator" style="display: none;">
        <div class="connection-status-content">
            <div class="connection-status-icon">
                <span
                    class="icon icon--lg"
                    aria-hidden="true"
                    style="--icon: url('/static/icons/round/warning.svg');"
                ></span>
            </div>
            <div class="connection-status-text">
                <div class="connection-status-title"></div>
                <div class="connection-status-message"></div>
            </div>
            <button id="connection-retry-btn" class="connection-retry-btn" style="display: none;">Refresh</button>
        </div>
    </div>

    <!-- Configuration passed from backend -->
    <script id="config-data" type="application/json">
        {
            "app_name": {{ app_name | tojson }},
            "auth_enabled": {{ auth_enabled | tojson }},
            "websocket_refresh_time": {{ websocket_refresh_time | tojson }},
            "websocket_ping_interval": {{ websocket_ping_interval | tojson }},
            "job_schema": {{ job_schema | tojson }},
            "agent_deployment": {{ agent_deployment | tojson }},
            "build": {{ build_metadata_payload | tojson }}
        }
    </script>
    <script src="/static/icons.js"></script>
    <script src="/static/websocket.js"></script>
    <script src="/static/overlay.js"></script>
    <script src="/static/views.js"></script>
    <script src="/static/main.js"></script>
</body>
</html>

version: 1
id: vm-provisioning
name: "Virtual machine provisioning"
description: "Schema describing inputs required to request a new virtual machine."
fields:
  - id: vm_name
    label: "VM name"
    description: "Unique name for the new virtual machine."
    type: string
    required: true
    validations:
      min_length: 1
      max_length: 64
  - id: image_name
    label: "Image"
    description: "Identifier of the golden image to clone."
    type: string
    required: true
  - id: hyperv_host
    label: "Destination host"
    description: "Hyper-V host that will receive the provisioning request."
    type: hostname
    required: true
  - id: gb_ram
    label: "Memory (GB)"
    description: "Amount of memory to assign to the VM in gigabytes."
    type: integer
    required: true
    default: 4
    validations:
      minimum: 1
      maximum: 512
  - id: cpu_cores
    label: "vCPUs"
    description: "Number of virtual CPU cores."
    type: integer
    required: true
    default: 2
    validations:
      minimum: 1
      maximum: 64
  - id: vlan_id
    label: "VLAN ID"
    description: "Optional VLAN identifier for the primary network adapter."
    type: integer
    required: false
    validations:
      minimum: 1
      maximum: 4094
  - id: guest_la_uid
    label: "Local administrator"
    description: "Username for the guest operating system's local administrator."
    type: string
    required: true
  - id: guest_la_pw
    label: "Local administrator password"
    description: "Password for the guest operating system's local administrator."
    type: secret
    required: true
  - id: guest_v4_ipaddr
    label: "IPv4 address"
    description: "Static IPv4 address to assign to the guest."
    type: ipv4
    required: false
  - id: guest_v4_cidrprefix
    label: "IPv4 prefix length"
    description: "CIDR prefix length that accompanies the static IPv4 address."
    type: integer
    required: false
    validations:
      minimum: 1
      maximum: 32
  - id: guest_v4_defaultgw
    label: "Default gateway"
    description: "Default IPv4 gateway for the guest."
    type: ipv4
    required: false
  - id: guest_v4_dns1
    label: "Primary DNS server"
    description: "Primary IPv4 DNS server for the guest."
    type: ipv4
    required: false
  - id: guest_v4_dns2
    label: "Secondary DNS server"
    description: "Secondary IPv4 DNS server for the guest."
    type: ipv4
    required: false
  - id: guest_net_dnssuffix
    label: "DNS suffix"
    description: "DNS search suffix for the guest network configuration."
    type: string
    required: false
  - id: guest_domain_jointarget
    label: "Domain FQDN"
    description: "Fully qualified domain name to join."
    type: string
    required: false
    applicability:
      os_family:
        - windows
  - id: guest_domain_joinuid
    label: "Domain join account"
    description: "User account used to join the domain."
    type: string
    required: false
    applicability:
      os_family:
        - windows
  - id: guest_domain_joinpw
    label: "Domain join password"
    description: "Password for the domain join account."
    type: secret
    required: false
    applicability:
      os_family:
        - windows
  - id: guest_domain_joinou
    label: "Domain join OU"
    description: "Organizational unit path for the computer account."
    type: string
    required: false
    applicability:
      os_family:
        - windows
  - id: cnf_ansible_ssh_user
    label: "Ansible SSH user"
    description: "Username used by Ansible for SSH automation."
    type: string
    required: false
    applicability:
      os_family:
        - linux
  - id: cnf_ansible_ssh_key
    label: "Ansible SSH public key"
    description: "Public key provided to the guest for Ansible SSH access."
    type: multiline
    required: false
    applicability:
      os_family:
        - linux
  - id: vm_clustered
    label: "Add VM to cluster"
    description: "Request that the new VM be registered with the Failover Cluster."
    type: boolean
    required: false
    default: false
parameter_sets:
  - id: static_ipv4
    label: "Static IPv4 configuration"
    description: "Supply every field to request a static IPv4 assignment; otherwise the guest will use DHCP."
    mode: all-or-none
    members:
      - guest_v4_ipaddr
      - guest_v4_cidrprefix
      - guest_v4_defaultgw
      - guest_v4_dns1
      - guest_v4_dns2
  - id: windows_domain_join
    label: "Windows domain join"
    description: "Provide all domain join fields to add the VM to an Active Directory domain."
    mode: all-or-none
    members:
      - guest_domain_jointarget
      - guest_domain_joinuid
      - guest_domain_joinpw
      - guest_domain_joinou
  - id: linux_ansible
    label: "Linux Ansible automation"
    description: "Provide SSH credentials to enable Ansible automation on Linux guests."
    mode: all-or-none
    members:
      - cnf_ansible_ssh_user
      - cnf_ansible_ssh_key
